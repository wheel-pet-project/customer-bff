# Микросервис Customer BFF

Backend for Frontend (BFF) сервис для мобильного приложения клиента для пет-проекта Wheel

## Описание

Customer BFF предоставляет единую точку входа для мобильного приложения клиента, агрегируя данные из различных микросервисов системы каршеринга. Сервис построен на основе REST API с использованием .NET 8 и обеспечивает оптимальный интерфейс для клиентских приложений.

## Архитектура

Проект состоит из следующих элементов:

- **Adapters/Http** - REST API контроллеры и контракты
- **Authorization** - система авторизации и проверки ролей
- **Middlewares** - промежуточное ПО для обработки запросов
- **Clients** - gRPC клиенты для взаимодействия с микросервисами
- **Interceptors** - перехватчики для логирования и трейсинга

## Интеграция с микросервисами

BFF взаимодействует со следующими микросервисами:

- **Identity** - аутентификация, авторизация и управление пользователями
- **VehicleFleet** - управление автопарком и информацией об автомобилях
- **Booking** - система бронирования автомобилей
- **Rent** - управление арендой автомобилей
- **Check** - проверка состояния автомобилей
- **DrivingLicense** - управление водительскими правами

## Технологический стек

- **.NET 8** - основная платформа
- **ASP.NET Core** - веб-фреймворк
- **gRPC** - взаимодействие с микросервисами
- **Swagger/OpenAPI** - документация API
- **Serilog** - структурированное логирование
- **OpenTelemetry** - трейсинг и метрики
- **Newtonsoft.Json** - сериализация JSON
- **Jaeger** - распределенная трассировка
- **Prometheus** - сбор метрик

## API Endpoints

### Аутентификация
- `POST /api/v1/identity/authenticate` - аутентификация пользователя
- `POST /api/v1/identity/create-account` - создание нового аккаунта
- `POST /api/v1/identity/refresh-access-token` - обновление токенов
- `POST /api/v1/identity/confirm-account-email` - подтверждение email
- `POST /api/v1/identity/recover-password` - запрос на сброс пароля
- `POST /api/v1/identity/update-password` - обновление пароля

### Транспорт
- `GET /api/v1/vehicles/{vehicleId}` - получение информации об автомобиле
- `POST /api/v1/vehicles/in-square` - поиск автомобилей в заданной области

### Бронирование
- `POST /api/v1/booking` - создание бронирования
- `GET /api/v1/booking/{bookingId}` - получение информации о бронировании

### Аренда
- `POST /api/v1/rent` - создание аренды
- `GET /api/v1/rent/{rentId}` - получение информации об аренде

### Проверка автомобиля
- `GET /api/v1/check/{vehicleId}` - получение состояния автомобиля

### Водительские права
- `GET /api/v1/driving-license` - получение информации о правах
- `POST /api/v1/driving-license` - загрузка прав

## Мониторинг и логирование

### Логирование
- Корреляционные ID для отслеживания запросов

### Трейсинг
- Распределенная трассировка с OpenTelemetry
- Экспорт трейсов в Jaeger
- Автоматическое создание спанов для gRPC вызовов

### Метрики
- Сбор метрик с Prometheus

## Безопасность

- JWT токены для аутентификации
- Проверка ролей на уровне контроллеров
- Логирование всех операций

## Разработка

### Запуск локальной среды
```bash
# Запуск с Docker Compose
docker-compose -f up-local-environment-compose.yml up
```



## Тестирование

Проект в данный момент тестами не покрыт
